From af049b21dde70d5545241d94afaa35c9715ceb02 Mon Sep 17 00:00:00 2001
From: "Jan Alexander Steffens (heftig)" <jan.steffens@gmail.com>
Date: Fri, 16 Aug 2013 23:24:45 +0200
Subject: [PATCH 072/100] exFAT Kconfig and build bits

Signed-off-by: artas182x <artas182x@gmail.com>
---
 fs/Kconfig             |  1 +
 fs/Makefile            |  3 ++-
 fs/exfat/Kconfig       | 19 +++++++++++++++++++
 fs/exfat/Makefile      | 26 ++------------------------
 fs/exfat/exfat_data.h  |  4 ----
 fs/exfat/exfat_super.c |  4 ++--
 6 files changed, 26 insertions(+), 31 deletions(-)
 create mode 100644 fs/exfat/Kconfig

diff --git a/fs/Kconfig b/fs/Kconfig
index ec035f1..4e7c85d 100644
--- a/fs/Kconfig
+++ b/fs/Kconfig
@@ -98,6 +98,7 @@ if BLOCK
 menu "DOS/FAT/NT Filesystems"
 
 source "fs/fat/Kconfig"
+source "fs/exfat/Kconfig"
 source "fs/ntfs/Kconfig"
 
 endmenu
diff --git a/fs/Makefile b/fs/Makefile
index f4462bb..9392fc4 100644
--- a/fs/Makefile
+++ b/fs/Makefile
@@ -78,6 +78,7 @@ obj-$(CONFIG_HUGETLBFS)		+= hugetlbfs/
 obj-$(CONFIG_CODA_FS)		+= coda/
 obj-$(CONFIG_MINIX_FS)		+= minix/
 obj-$(CONFIG_FAT_FS)		+= fat/
+obj-$(CONFIG_EXFAT_FS)		+= exfat/
 obj-$(CONFIG_BFS_FS)		+= bfs/
 obj-$(CONFIG_ISO9660_FS)	+= isofs/
 obj-$(CONFIG_HFSPLUS_FS)	+= hfsplus/ # Before hfs to find wrapped HFS+
@@ -125,7 +126,7 @@ obj-$(CONFIG_EXOFS_FS)          += exofs/
 obj-$(CONFIG_F2FS_FS)		+= f2fs/
 obj-$(CONFIG_CEPH_FS)		+= ceph/
 obj-$(CONFIG_PSTORE)		+= pstore/
-obj-y				+= exfat/
++obj-$(CONFIG_EXFAT_FS)		+= exfat/
 
 # Patched by YAFFS
 obj-$(CONFIG_YAFFS_FS)		+= yaffs2/
diff --git a/fs/exfat/Kconfig b/fs/exfat/Kconfig
new file mode 100644
index 0000000..144b6ec
--- /dev/null
+++ b/fs/exfat/Kconfig
@@ -0,0 +1,19 @@
+config EXFAT_FS
+	tristate "exFAT filesystem support"
+	select NLS
+	help
+	  exFAT driver from Samsung
+
+config EXFAT_DEFAULT_CODEPAGE
+	int "Default codepage for exFAT"
+	depends on EXFAT_FS
+	default 437
+	help
+	  This option should be set to the codepage of your exFAT filesystems.
+
+config EXFAT_DEFAULT_IOCHARSET
+	string "Default iocharset for exFAT"
+	depends on EXFAT_FS
+	default "utf8"
+	help
+	  Set this to the default input/output character set you'd like exFAT to use.
diff --git a/fs/exfat/Makefile b/fs/exfat/Makefile
index da38ef4..77dc36c 100644
--- a/fs/exfat/Makefile
+++ b/fs/exfat/Makefile
@@ -1,26 +1,4 @@
-# Exfat Linux kernel modules
-#
-
-obj-m += exfat.o
+obj-$(CONFIG_EXFAT_FS) += exfat.o
 
 exfat-y := exfat_core.o exfat_api.o exfat_blkdev.o exfat_cache.o exfat_super.o \
-		   exfat_data.o exfat_global.o exfat_nls.o exfat_oal.o exfat_upcase.o
-
-EXTRA_FLAGS += -I$(PWD)
-
-#KDIR	:= /usr/src/linux/
-KDIR	:= /lib/modules/$(shell uname -r)/build
-PWD		:= $(shell pwd)
-
-all:
-	$(MAKE) -C $(KDIR) M=$(PWD) modules
-
-clean:
-	$(MAKE) -C $(KDIR) M=$(PWD) clean
-
-help:
-	$(MAKE) -C $(KDIR) M=$(PWD) help
-
-.PHONY : install
-install : all
-	sudo $(MAKE) -C $(KDIR) M=$(PWD) modules_install; sudo depmod
+	   exfat_data.o exfat_global.o exfat_nls.o exfat_oal.o exfat_upcase.o
diff --git a/fs/exfat/exfat_data.h b/fs/exfat/exfat_data.h
index f920c24f..e99551d 100644
--- a/fs/exfat/exfat_data.h
+++ b/fs/exfat/exfat_data.h
@@ -69,10 +69,6 @@ extern "C" {
 #define BUF_CACHE_SIZE          256
 #define BUF_CACHE_HASH_SIZE     64
 
-	/* default mount options                            */
-#define DEFAULT_CODEPAGE        437
-#define DEFAULT_IOCHARSET       "utf8"
-
 #ifdef __cplusplus
 }
 #endif /* __cplusplus */
diff --git a/fs/exfat/exfat_super.c b/fs/exfat/exfat_super.c
index 32de8e4..af6394d 100644
--- a/fs/exfat/exfat_super.c
+++ b/fs/exfat/exfat_super.c
@@ -92,8 +92,8 @@
 
 static struct kmem_cache *exfat_inode_cachep;
 
-static int exfat_default_codepage = DEFAULT_CODEPAGE;
-static char exfat_default_iocharset[] = DEFAULT_IOCHARSET;
+static int exfat_default_codepage = CONFIG_EXFAT_DEFAULT_CODEPAGE;
+static char exfat_default_iocharset[] = CONFIG_EXFAT_DEFAULT_IOCHARSET;
 
 extern struct timezone sys_tz;
 
-- 
1.9.1

