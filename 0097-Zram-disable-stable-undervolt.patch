From e50973a5edbc850279553387b6663a82b03b4bab Mon Sep 17 00:00:00 2001
From: artas182x <artas182x@gmail.com>
Date: Mon, 14 Jul 2014 20:41:11 +0200
Subject: [PATCH 097/100] Zram disable, stable undervolt

---
 arch/arm/configs/cyanogenmod_p760_defconfig |  4 ++--
 arch/arm/mach-omap2/opp4xxx_data.c          |  2 +-
 arch/arm/mach-omap2/smartreflex-class1p5.c  | 12 +++++++++---
 3 files changed, 12 insertions(+), 6 deletions(-)

diff --git a/arch/arm/configs/cyanogenmod_p760_defconfig b/arch/arm/configs/cyanogenmod_p760_defconfig
index cdf49b1..d7413ba 100755
--- a/arch/arm/configs/cyanogenmod_p760_defconfig
+++ b/arch/arm/configs/cyanogenmod_p760_defconfig
@@ -46,7 +46,7 @@ CONFIG_HAVE_KERNEL_LZO=y
 # CONFIG_KERNEL_LZMA is not set
 CONFIG_KERNEL_LZO=y
 CONFIG_DEFAULT_HOSTNAME="(none)"
-CONFIG_SWAP=y
+CONFIG_SWAP=n
 CONFIG_SYSVIPC=y
 CONFIG_SYSVIPC_SYSCTL=y
 # CONFIG_POSIX_MQUEUE is not set
@@ -2480,7 +2480,7 @@ CONFIG_IIO=y
 # Triggers - standalone
 #
 CONFIG_XVMALLOC=y
-CONFIG_ZRAM=y
+CONFIG_ZRAM=n
 # CONFIG_FB_SM7XX is not set
 # CONFIG_LIRC_STAGING is not set
 CONFIG_MACH_NO_WESTBRIDGE=y
diff --git a/arch/arm/mach-omap2/opp4xxx_data.c b/arch/arm/mach-omap2/opp4xxx_data.c
index 56e3cef..aa644c8 100644
--- a/arch/arm/mach-omap2/opp4xxx_data.c
+++ b/arch/arm/mach-omap2/opp4xxx_data.c
@@ -181,7 +181,7 @@ struct omap_vdd_dep_info omap443x_vddiva_dep_info[] = {
 static struct omap_opp_def __initdata omap443x_opp_def_list[] = {
 	OPP_INITIALIZER("mpu", "dpll_mpu_ck", "mpu", true, 200000000, OMAP4430_VDD_MPU_OPP25_UV),
 	/* MPU OPP1 - OPP50 */
-	OPP_INITIALIZER("mpu", "dpll_mpu_ck", "mpu", true, 340000000, OMAP4430_VDD_MPU_OPP50_UV),
+	OPP_INITIALIZER("mpu", "dpll_mpu_ck", "mpu", true, 300000000, OMAP4430_VDD_MPU_OPP50_UV),
 	/* MPU OPP2 - OPP100 */
 	OPP_INITIALIZER("mpu", "dpll_mpu_ck", "mpu", true, 600000000, OMAP4430_VDD_MPU_OPP100_UV),
 	/* MPU OPP3 - OPP-Turbo */
diff --git a/arch/arm/mach-omap2/smartreflex-class1p5.c b/arch/arm/mach-omap2/smartreflex-class1p5.c
index e45e070..4d047cc 100644
--- a/arch/arm/mach-omap2/smartreflex-class1p5.c
+++ b/arch/arm/mach-omap2/smartreflex-class1p5.c
@@ -302,10 +302,16 @@ done_calib:
 			u_volt_current);
 	}
 
-	if(volt_data->volt_nominal == 1010000)
-	volt_data->volt_calibrated = u_volt_safe - 75;
+	if (voltdm->name=="mpu")
+	{
+	if (volt_data->volt_nominal==995000)
+	volt_data->volt_calibrated = u_volt_safe;
 	else
-	volt_data->volt_calibrated = u_volt_safe - 99;
+	volt_data->volt_calibrated = u_volt_safe - 55000;
+	}
+	else
+	volt_data->volt_calibrated = u_volt_safe - 30000;
+
 	/* Setup my dynamic voltage for the next calibration for this opp */
 	volt_data->volt_dynamic_nominal = omap_get_dyn_nominal(volt_data);
 
-- 
1.9.1

